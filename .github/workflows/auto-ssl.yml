name: Auto SSL

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'test'
        default: 'latest'
        required: false
        type: string

env:
  ACME: /home/runner/.acme.sh/acme.sh
  Ali_Key: ${{ secrets.Ali_Key }}
  Ali_Secret: ${{ secrets.Ali_Secret }}

jobs:
  acme:
    runs-on: ubuntu-latest
    steps:
      - name: Install ACME.SH
        run: |
          curl  https://get.acme.sh | sh
      - uses: actions/checkout@v3
      - name: Create xuexb SSL
        run: |
          mkdir -p ./ca/xuexb
          $ACME --issue \
            --server letsencrypt \
            --dns dns_ali \
            --log \
            -d "xuexb.com" \
            -d "xuexb.cn" \
            -d "*.xuexb.cn" \
            -d "*.xuexb.com" \
            -d "*.static.xuexb.com" \
            -d "*.dev.xuexb.com" \
            -d "*.proxy.xuexb.com" \
            -d "*.api.xuexb.com"
          $ACME --installcert \
            -d "xuexb.com" \
            --key-file ./ca/xuexb/xuexb.key \
            --fullchain-file ./ca/xuexb/xuexb.cer
      - name: Create jiandansousuo SSL
        run: |
          mkdir -p ./ca/jiandansousuo
          $ACME --issue \
            --server letsencrypt \
            --dns dns_ali \
            --log \
            -d "jiandansousuo.com" \
            -d "jiandansousuo.cn" \
            -d "*.jiandansousuo.cn" \
            -d "*.jiandansousuo.com"
          $ACME --installcert \
            -d "jiandansousuo.com" \
            --key-file ./ca/jiandansousuo/jiandansousuo.key \
            --fullchain-file ./ca/jiandansousuo/jiandansousuo.cer
      - name: Git push
        run: |
          git config user.name xuexb
          git config user.email fe.xiaowu@gmail.com
          git add .
          git commit -m "feat: Add SSL [skip ci]"
          git push
